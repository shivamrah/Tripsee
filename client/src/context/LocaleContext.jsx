import React, { createContext, useState, useEffect } from "react";

export const LocaleContext = createContext(null);

const TRANSLATIONS = {
    en: {
        home: "Home",
        admin: "Admin",
        myBookings: "My Bookings",
        profile: "Profile",
        logout: "Logout",
        login: "Login",
        signup: "Sign Up",
        savedTrips: "Saved Trips",
        upcomingBookings: "Upcoming Bookings",
        // common
        search: "Search",
        searchPlaceholder: "Search for your destination",
        addToMyTrips: "Added to My Trips",
        addToMyTripsBtn: "+ My Trips",
        addedToPackage: "Added to Package",
        addToPackageBtn: "Add to Package",
        bookNow: "Book Now",
        bookTickets: "Book Tickets",
        proceedToPayment: "Proceed to Payment",
        confirmBooking: "Confirm Booking",
        cancel: "Cancel",
        remove: "Remove",
        total: "Total",
        destination: "Destination",
        price: "Price",
        totalSeats: "Total Seats",
        tripImage: "Trip Image",
        save: "Save",
        saving: "Saving...",
        loadingDashboard: "Loading dashboard...",
        noSavedTrips: "You have no saved trips. Add trips to My Trips to see them here.",
        noUpcomingTrips: "You have no upcoming trips.",
        noPastTrips: "You have no past trips.",
        chooseDepartureTitle: "Choose departure",
        searchCityPlaceholder: "Search city (all India)",
        bookFromSelectedLocation: "Book Bus Tickets from Selected Location",
        pleaseLogInToViewBookings: "Please log in to view your bookings.",
        failedToFetchBookings: "Failed to fetch your bookings.",
        printFailedCopy: "Print failed. Please copy or save the ticket manually.",
        printFailedPopup: "Print failed. Please check your popup blocker or try copying the ticket content.",
        unablePrint: "Unable to print the ticket. Please check your popup blocker or try the Download (PDF) option.",
        unableOpenPrintWindow: "Unable to open print window. Please check your popup blocker.",
        pleaseSelectDepartureModal: "Please select a departure location.",
        pleaseChooseTravelDate: "Please choose a travel date.",
        travelDateCannotBePast: "Travel date cannot be in the past.",
        pleaseSelectAtLeastOneSeat: "Please select at least one seat.",
        change: "Change",
        tripInfoNotAvailable: "Trip information not available.",
        searching: "Searching...",
        noResults: "No results",
        selectedTrip: "selected trip",
        seatsCommaHint: "Seats (comma separated)",
        totalAmountLabel: "Total Amount",
        travelDateLabel: "Travel Date",
        fromLocationLabel: "From Location",
        failedToSaveBooking: "Failed to save booking. See console for details.",
        // admin
        adminDashboard: "Admin Dashboard",
        tripManagement: "Trip Management",
        bookingManagement: "Booking Management",
        sourceLabel: "Source",
        destinationLabel: "Destination",
        priceLabel: "Price",
        seatsLabelShort: "Seats",
        actionsLabel: "Actions",
        failedToSaveTrip: "Failed to save trip. Please check the console for details.",
        couldNotLoadBookingDetails: "Could not load booking details.",
        confirmDeleteBooking: "Delete this booking?",
        confirmDeleteTrip: "Are you sure you want to delete this trip?",
        failedToDeleteBooking: "Failed to delete booking. See console for details.",
    },
    hi: {
        home: "होम",
        admin: "एडमिन",
        myBookings: "मेरी बुकिंग्स",
        profile: "प्रोफ़ाइल",
        logout: "लॉगआउट",
        login: "लॉगिन",
        signup: "साइन अप",
        savedTrips: "सहेजे गए यात्रा",
        upcomingBookings: "आगामी बुकिंग्स",
        // common
        search: "खोजें",
        searchPlaceholder: "अपना गंतव्य खोजें",
        addToMyTrips: "मेरी यात्राओं में जोड़ा गया",
        addToMyTripsBtn: "+ मेरी यात्राएँ",
        bookNow: "अभी बुक करें",
        bookTickets: "टिकट बुक करें",
        proceedToPayment: "भुगतान पर जाएं",
        confirmBooking: "बुकिंग की पुष्टि करें",
        cancel: "रद्द करें",
        remove: "हटाएँ",
        total: "कुल",
        selectedSeats: "चयनित सीटें",
        perPerson: "प्रति व्यक्ति",
        loading: "लोड हो रहा है...",
        noData: "के लिए कोई डेटा नहीं मिला",
        myTripsTitle: "मेरी यात्राएँ",
        bookingFailed: "बुकिंग विफल। कृपया बाद में पुनः प्रयास करें।",
        pleaseSelectSeat: "कृपया कम से कम एक सीट चुनें।",
        pleaseSelectDate: "कृपया अपनी यात्रा के लिए एक तिथि चुनें।",
        pleaseSelectDeparture: "कृपया प्रस्थान स्थान चुनें।",
        pleaseChooseValidDate: "कृपया एक वैध भविष्य की तिथि चुनें।",
        bookingConfirmed: "बुकिंग की पुष्टि हुई!",
        bookingSuccessSubtitle: "आपकी यात्रा सफलतापूर्वक बुक हो गई है। यात्रा का आनंद लें!",
        downloadTicket: "टिकट डाउनलोड करें",
        viewAllBookings: "सभी बुकिंग देखें",
        dateLabel: "तारीख",
        seatsLabel: "सीटें",
        totalFarePaid: "कुल भुगतान",
        scanQr: "बोर्डिंग गेट पर इस क्यूआर कोड को स्कैन करें।",
        flightTicket: "फ्लाइट टिकट",
        processing: "प्रसंस्करण...",
        sendUpiAndBook: "UPI अनुरोध भेजें और बुक करें",
        completePayment: "भुगतान पूरा करें",
        aboutTitle: "TripSee के बारे में",
        aboutIntro: "TripSee एक हल्का ट्रिप डिस्कवरी और बुकिंग डेमो एप्लिकेशन है जो पूर्ण-स्टैक जावास्क्रिप्ट ट्रैवल बुकिंग अनुभव दिखाने के लिए बनाया गया है।",
        whatThisProject: "यह परियोजना क्या करती है",
        aboutFeature1: "राज्यों में ट्रिप और आकर्षण खोजें।",
        aboutFeature2: "एक सरल चेकआउट फ़्लो के साथ सीटें चुनें और टिकट बुक करें।",
        aboutFeature3: "नियोजित 'My Bookings' व्यू में अपनी बुकिंग देखें और प्रबंधित करें।",
        aboutFeature4: "ट्रिप बनाने और बुकिंग देखने के लिए एडमिन डैशबोर्ड।",
        techStackTitle: "टेक स्टैक",
        whyTitle: "यह परियोजना क्यों",
        techStackText: "फ्रंटेंड: React + Vite। बैकएंड: Node.js, Express। डेटाबेस: MongoDB। इमेजेज़ Cloudinary द्वारा संभाली जाती हैं। प्रमाणीकरण JWT का उपयोग करता है।",
        whyText: "यह परियोजना मेंटेनबिलिटी, सरल APIs और रेस्पॉन्सिव UI पर ध्यान देते हुए संक्षिप्त, व्यावहारिक ट्रैवल बुकिंग फ्लो का प्रदर्शन करती है।",
        contactTitle: "संपर्क",
        contactHelpLinkText: "यदि आपको सहायता चाहिए या योगदान करना चाहते हैं, तो हेल्प सेंटर देखें।",
        helpCenter: "हेल्प सेंटर",
        helpSupportTitle: "TripSee — विश्वसनीय यात्रा और ट्रिप बुकिंग सेवा।",
        helpContactHint: "सपोर्ट से संपर्क करते समय अपने बुकिंग आईडी और एक संक्षिप्त विवरण शामिल करें।",
        helpIntro: "यदि आपको सहायता की आवश्यकता है, हम मदद के लिए यहां हैं। नीचे हमें पहुंचने के सर्वश्रेष्ठ तरीके दिए गए हैं।",
        contactSupport: "सपोर्ट से संपर्क करें",
        company: "कंपनी",
        addressLabel: "पता:",
        resources: "संसाधन",
        privacyList1: "बुकिंग जानकारी जिसमें ट्रिप चयन, सीटें, यात्रा तिथियाँ और भुगतान मेटाडेटा शामिल हैं।",
        privacyList2: "बुकिंग सेवा प्रदान करने और बुकिंग को प्रोसेस करने के लिए।",
        privacyTitle: "गोपनीयता नीति",
        privacyLead: "यह गोपनीयता नीति समझाती है कि TripSee आपकी व्यक्तिगत जानकारी कैसे एकत्र करता है, उपयोग करता है, प्रकट करता है और सुरक्षित करता है।",
        cancel: "रद्द करें",
        remove: "हटाएँ",
        ok: "ठीक है",
        details: "विवरण",
        edit: "संपादित करें",
        delete: "हटाएँ",
        addNewTrip: "+ नया ट्रिप जोड़ें",
        editTrip: "ट्रिप संपादित करें",
        source: "सोर्स",
        destination: "डेस्टिनेशन",
        price: "कीमत",
        totalSeats: "कुल सीटें",
        tripImage: "ट्रिप इमेज",
        save: "सहेजें",
        saving: "सहेजा जा रहा है...",
        loadingDashboard: "डैशबोर्ड लोड हो रहा है...",
        noSavedTrips: "आपके पास कोई सहेजा हुआ ट्रिप नहीं है। 'My Trips' में ट्रिप जोड़ें ताकि वे यहां दिखें।",
        noUpcomingTrips: "आपके पास कोई आगामी ट्रिप नहीं है।",
        noPastTrips: "आपके पास कोई पिछले ट्रिप नहीं हैं।",
        chooseDepartureTitle: "प्रस्थान चुनें",
        searchCityPlaceholder: "शहर खोजें (पूरे भारत में)",
        bookFromSelectedLocation: "चयनित स्थान से बस टिकट बुक करें",
        pleaseLogInToViewBookings: "कृपया अपनी बुकिंग देखने के लिए लॉग इन करें।",
        failedToFetchBookings: "आपकी बुकिंग लाने में विफल।",
        printFailedCopy: "प्रिंट विफल। कृपया टिकट मैन्युअल रूप से कॉपी या सहेजें।",
        printFailedPopup: "प्रिंट विफल। कृपया अपने पॉपअप ब्लॉकर की जाँच करें या टिकट सामग्री कॉपी करने का प्रयास करें।",
        unablePrint: "टिकट प्रिंट करने में असमर्थ। कृपया अपने पॉपअप ब्लॉकर की जाँच करें या PDF विकल्प का प्रयास करें।",
        unableOpenPrintWindow: "प्रिंट विंडो खोलने में असमर्थ। कृपया अपने पॉपअप ब्लॉकर की जाँच करें।",
        pleaseSelectDepartureModal: "कृपया एक प्रस्थान स्थान चुनें।",
        pleaseChooseTravelDate: "कृपया एक यात्रा तिथि चुनें।",
        travelDateCannotBePast: "यात्रा की तिथि अतीत में नहीं हो सकती।",
        pleaseSelectAtLeastOneSeat: "कृपया कम से कम एक सीट चुनें।",
        change: "बदलें",
        // admin
        adminDashboard: "एडमिन डैशबोर्ड",
        tripManagement: "ट्रिप प्रबंधन",
        bookingManagement: "बुकिंग प्रबंधन",
        sourceLabel: "सोर्स",
        destinationLabel: "डेस्टिनेशन",
        priceLabel: "कीमत",
        seatsLabelShort: "सीटें",
        actionsLabel: "कार्रवाई",
        failedToSaveTrip: "ट्रिप सहेजने में विफल। कृपया विवरण के लिए कंसोल देखें।",
        couldNotLoadBookingDetails: "बुकिंग विवरण लोड नहीं कर सके।",
        confirmDeleteBooking: "क्या आप इस बुकिंग को हटाना चाहते हैं?",
        confirmDeleteTrip: "क्या आप वाकई इस ट्रिप को हटाना चाहते हैं?",
        failedToDeleteBooking: "बुकिंग हटाने में विफल। विवरण के लिए कंसोल देखें।",
        tripInfoNotAvailable: "ट्रिप जानकारी उपलब्ध नहीं है।",
        searching: "खोज रहा है...",
        noResults: "कोई परिणाम नहीं",
        selectedTrip: "चयनित यात्रा",
        seatsCommaHint: "सीटें (कॉमा से अलग करें)",
        totalAmountLabel: "कुल राशि",
        travelDateLabel: "यात्रा की तिथि",
        fromLocationLabel: "प्रस्थान स्थान",
        failedToSaveBooking: "बुकिंग सहेजने में विफल। विवरण के लिए कंसोल देखें।",
        chooseYourDestination: "अपना गंतव्य चुनें",
        noMatchingStates: "कोई मेल খाता राज्य नहीं",
    },
    bn: {
        home: "হোম",
        admin: "অ্যাডমিন",
        myBookings: "আমার বুকিং",
        profile: "প্রোফাইল",
        logout: "লগআউট",
        login: "লগইন",
        signup: "সাইন আপ",
        savedTrips: "সংরক্ষিত ভ্রমণ",
        upcomingBookings: "আসন্ন বুকিং",
        // common
        search: "খোঁজ",
        searchPlaceholder: "আপনার গন্তব্য খুঁজুন",
        addToMyTrips: "আমার ট্রিপে যোগ করা হয়েছে",
        addToMyTripsBtn: "+ আমার ট্রিপস",
        bookNow: "এখন বুক করুন",
        bookTickets: "টিকিট বুক করুন",
        proceedToPayment: "পেমেন্ট করুন",
        confirmBooking: "বুকিং নিশ্চিত করুন",
        cancel: "বাতিল করুন",
        remove: "অপসারণ",
        total: "মোট",
        selectedSeats: "নির্বাচিত সীট",
        perPerson: "প্রতি ব্যক্তি",
        loading: "লোড করা হচ্ছে...",
        noData: "যাতে ডেটা পাওয়া যায়নি",
        myTripsTitle: "আমার ট্রিপস",
        bookingFailed: "বুকিং ব্যর্থ। অনুগ্রহ করে পরে চেষ্টা করুন.",
        pleaseSelectSeat: "অনুগ্রহ করে অন্তত একটি সীট নির্বাচন করুন।",
        pleaseSelectDate: "অনুগ্রহ করে আপনার সফরের জন্য একটি তারিখ নির্বাচন করুন।",
        pleaseSelectDeparture: "অনুগ্রহ করে প্রস্থান স্থান নির্বাচন করুন।",
        pleaseChooseValidDate: "একটি বৈধ ভবিষ্যৎ তারিখ নির্বাচন করুন।",
        bookingConfirmed: "বুকিং নিশ্চিত!",
        bookingSuccessSubtitle: "আপনার ট্রিপ সফলভাবে বুক করা হয়েছে। আপনার যাত্রার আনন্দ নিন!",
        downloadTicket: "টিকিট ডাউনলোড করুন",
        viewAllBookings: "সমস্ত বুকিং দেখুন",
        dateLabel: "তারিখ",
        seatsLabel: "সীট",
        totalFarePaid: "মোট পরিশোধিত",
        scanQr: "বোর্ডিং গেটে এই কিউআর কোড স্ক্যান করুন।",
        flightTicket: "ফ্লাইট টিকিট",
        processing: "প্রসেসিং...",
        sendUpiAndBook: "UPI অনুরোধ পাঠান এবং বুক করুন",
        completePayment: "পেমেন্ট সম্পন্ন করুন",
        aboutTitle: "TripSee সম্পর্কে",
        aboutIntro: "TripSee হল একটি হালকা ট্রিপ ডিসকভারি এবং বুকিং ডেমো অ্যাপ্লিকেশন যা সম্পূর্ণ-স্ট্যাক জাভাস্ক্রিপ্ট ট্রাভেল বুকিং অভিজ্ঞতা প্রদর্শন করার জন্য নির্মিত।",
        whatThisProject: "এই প্রকল্পটি কি করে",
        aboutFeature1: "রাজ্যগুলিতে ট্রিপ এবং আকর্ষণ আবিষ্কার করুন।",
        aboutFeature2: "সরল চেকআউট ফ্লো দিয়ে সিট নির্বাচন করুন এবং টিকেট বুক করুন।",
        aboutFeature3: "My Bookings ভিউতে আপনার বুকিংগুলি দেখুন এবং পরিচালনা করুন।",
        aboutFeature4: "ট্রিপ তৈরি এবং বুকিং দেখার জন্য অ্যাডমিন ড্যাশবোর্ড।",
        techStackTitle: "টেক স্ট্যাক",
        whyTitle: "কেন এই প্রকল্প",
        techStackText: "ফ্রন্টএন্ড: React + Vite। ব্যাকএন্ড: Node.js, Express। ডাটাবেস: MongoDB। ইমেজগুলো Cloudinary দ্বারা পরিচালিত। অথেনটিকেশন JWT ব্যবহার করে।",
        whyText: "এই প্রকল্পটি রক্ষণযোগ্যতা, সহজ API এবং প্রতিক্রিয়াশীল UI-তে জোর দিয়ে একটি সংক্ষিপ্ত, ব্যবহারিক ট্র্যাভেল বুকিং ফ্লো প্রদর্শন করে।",
        contactTitle: "যোগাযোগ",
        contactHelpLinkText: "আপনি যদি সাহায্য চান বা অবদান রাখতে চান, তাহলে হেল্প সেন্টার দেখুন।",
        helpCenter: "হেল্প সেন্টার",
        helpSupportTitle: "TripSee — ট্রাস্টেড ট্র্যাভেল এবং ট্রিপ বুকিং সার্ভিস।",
        helpContactHint: "সহায়তার সাথে যোগাযোগ করার সময় আপনার বুকিং আইডি এবং একটি সংক্ষিপ্ত বিবরণ অন্তর্ভুক্ত করুন।",
        helpIntro: "আপনি যদি সহায়তা প্রয়োজন, আমরা সাহায্য করতে এখানে আছি। নিচে আমাদের কাছে পৌঁছানোর সেরা উপায়সমূহ দেওয়া আছে।",
        contactSupport: "সাপোর্টে যোগাযোগ",
        company: "কোম্পানি",
        addressLabel: "ঠিকানা:",
        resources: "রিসোর্সেস",
        privacyList1: "বুকিং তথ্য যার মধ্যে ট্রিপ নির্বাচন, সিট, ট্রাভেল তারিখ এবং পেমেন্ট মেটাডেটা অন্তর্ভুক্ত।",
        privacyList2: "বুকিং সেবা প্রদান এবং বুকিং প্রক্রিয়াকরণের জন্য।",
        privacyTitle: "গোপনীয়তা নীতি",
        privacyLead: "এই গোপনীয়তা নীতি ব্যাখ্যা করে কিভাবে TripSee আপনার ব্যক্তিগত তথ্য সংগ্রহ করে, ব্যবহার করে, প্রকাশ করে এবং সুরক্ষিত রাখে।",
        cancel: "বাতিল করুন",
        remove: "অপসারণ",
        ok: "ঠিক আছে",
        details: "বিবরণ",
        edit: "সংশোধন",
        delete: "মুছে ফেলুন",
        addNewTrip: "+ নতুন ট্রিপ যোগ করুন",
        editTrip: "ট্রিপ সম্পাদনা করুন",
        source: "উৎস",
        destination: "গন্তব্য",
        price: "মূল্য",
        totalSeats: "মোট সিট",
        tripImage: "ট্রিপ ইমেজ",
        save: "সংরক্ষণ করুন",
        saving: "সংরক্ষণ করা হচ্ছে...",
        loadingDashboard: "ড্যাশবোর্ড লোড হচ্ছে...",
        noSavedTrips: "আপনার কোন সংরক্ষিত ট্রিপ নেই। এখানে দেখতে 'My Trips' এ ট্রিপ যোগ করুন।",
        noUpcomingTrips: "আপনার কোন আসন্ন ট্রিপ নেই।",
        noPastTrips: "আপনার কোন অতীত ট্রিপ নেই।",
        chooseDepartureTitle: "প্রস্থান বেছে নিন",
        searchCityPlaceholder: "শহর খুঁজুন (সমগ্র ভারত)",
        bookFromSelectedLocation: "নির্বাচিত অবস্থান থেকে বাস টিকিট বুক করুন",
        pleaseLogInToViewBookings: "আপনার বুকিং দেখতে দয়া করে লগইন করুন।",
        failedToFetchBookings: "আপনার বুকিং আনতে ব্যর্থ।",
        printFailedCopy: "প্রিন্ট ব্যর্থ। অনুগ্রহ করে টিকিটটি ম্যানুয়ালি কপি বা সংরক্ষণ করুন।",
        printFailedPopup: "প্রিন্ট ব্যর্থ। অনুগ্রহ করে আপনার পপআপ ব্লকার পরীক্ষা করুন বা টিকিট কনটেন্ট কপি করার চেষ্টা করুন।",
        unablePrint: "টিকিট প্রিন্ট করতে অক্ষম। অনুগ্রহ করে আপনার পপআপ ব্লকার পরীক্ষা করুন বা PDF বিকল্পটি চেষ্টা করুন।",
        unableOpenPrintWindow: "প্রিন্ট উইন্ডো খুলতে অক্ষম। অনুগ্রহ করে আপনার পপআপ ব্লকার পরীক্ষা করুন।",
        pleaseSelectDepartureModal: "অনুগ্রহ করে একটি প্রস্থান স্থান নির্বাচন করুন।",
        pleaseChooseTravelDate: "অনুগ্রহ করে একটি ভ্রমণের তারিখ নির্বাচন করুন।",
        travelDateCannotBePast: "ভ্রমণের তারিখ অতীতে থাকতে পারে না।",
        pleaseSelectAtLeastOneSeat: "অনুগ্রহ করে অন্তত একটি সীট নির্বাচন করুন।",
        change: "পরিবর্তন",
        // admin
        adminDashboard: "অ্যাডমিন ড্যাসবোর্ড",
        tripManagement: "ট্রিপ ম্যানেজমেন্ট",
        bookingManagement: "বুকিং ম্যানেজমেন্ট",
        sourceLabel: "মূলে",
        destinationLabel: "গন্তব্য",
        priceLabel: "দাম",
        seatsLabelShort: "সিট",
        actionsLabel: "কার্যকলাপ",
        failedToSaveTrip: "ট্রিপ সেভ করতে ব্যর্থ। অনুগ্রহ করে কনসোলে বিস্তারিত দেখুন।",
        couldNotLoadBookingDetails: "বুকিং বিবরণ লোড করা যায়নি।",
        confirmDeleteBooking: "এই বুকিং মুছতে চান?",
        confirmDeleteTrip: "আপনি কি নিশ্চিত এই ট্রিপটি মুছতে চান?",
        failedToDeleteBooking: "বুকিং মুছতে ব্যর্থ। কনসোলে বিস্তারিত দেখুন।",
        tripInfoNotAvailable: "ট্রিপ তথ্য উপলব্ধ নেই।",
        searching: "সার্চ হচ্ছে...",
        noResults: "কোন ফলাফল নেই",
        selectedTrip: "নির্বাচিত ট্রিপ",
        chooseYourDestination: "আপনার গন্তব্য নির্বাচন করুন",
        noMatchingStates: "কোন মিলকারী রাজ্য নেই",
        seatsCommaHint: "সিট (কমা দিয়ে আলাদা)",
        totalAmountLabel: "মোট পরিমাণ",
        travelDateLabel: "ভ্রমণের তারিখ",
        fromLocationLabel: "ফ্রম লোকেশন",
        failedToSaveBooking: "বুকিং সংরক্ষণ করতে ব্যর্থ। বিস্তারিত কনসোলে দেখুন।",
    },
};

export const LocaleProvider = ({ children }) => {
    const [locale, setLocale] = useState("en");

    useEffect(() => {
        try {
            const raw = localStorage.getItem("locale");
            if (raw) setLocale(raw);
        } catch (e) { }
    }, []);

    const setLang = (lang) => {
        setLocale(lang);
        try {
            localStorage.setItem("locale", lang);
        } catch (e) { }
        // dispatch event so other components can react
        window.dispatchEvent(new Event("localeChanged"));
    };

    const t = (key) => {
        return (TRANSLATIONS[locale] && TRANSLATIONS[locale][key]) || TRANSLATIONS.en[key] || key;
    };

    const formatCurrency = (amount, opts = {}) => {
        try {
            const currency = opts.currency || "INR";
            const maximumFractionDigits = (opts.maximumFractionDigits != null) ? opts.maximumFractionDigits : 0;
            const localeTag = locale === "en" ? "en-IN" : `${locale}-IN`;
            return new Intl.NumberFormat(localeTag, { style: "currency", currency, maximumFractionDigits }).format(amount);
        } catch (e) {
            return amount;
        }
    };

    return (
        <LocaleContext.Provider value={{ locale, setLang, t, formatCurrency }}>
            {children}
        </LocaleContext.Provider>
    );
};

export default LocaleContext;
